{
  "version": "1.0.0",
  "title": "Delay should not impact processing",
  "description": "Inject latency into Lambda function execution and ensure files are still processed.",
  "tags": [
      "serverless",
      "cloudnative",
      "etl"
  ],
  "configuration": {
      "s3_bucket": {
          "type": "env",
          "key": "S3_BUCKET"
      },
      "sns_topic": {
          "type": "env",
          "key": "SNS_TOPIC"
      },
      "lambda_function": {
          "type": "env",
          "key": "LAMBDA_FUNCTION"
      }
  },
  "steady-state-hypothesis": {
      "title": "Services are all available and healthy",
      "probes": [
          {
              "type": "probe",
              "name": "zero-sns-errors",
              "tolerance": 0,
              "provider": {
                  "type": "python",
                  "module": "chaosaws.cloudwatch.probes",
                  "func": "get_metric_statistics",
                  "arguments": {
                      "namespace": "AWS/SNS",
                      "metric_name": "NumberOfNotificationsFailed",
                      "dimension_name": "TopicName",
                      "dimension_value": "${sns_topic}",
                      "statistic": "Sum",
                      "duration": 3600
                  }
              }
          },
          {
              "type": "probe",
              "name": "zero-lambda-errors",
              "tolerance": 0,
              "provider": {
                  "type": "python",
                  "module": "chaosaws.cloudwatch.probes",
                  "func": "get_metric_statistics",
                  "arguments": {
                      "namespace": "AWS/Lambda",
                      "metric_name": "Errors",
                      "dimension_name": "FunctionName",
                      "dimension_value": "${lambda_function}",
                      "statistic": "Sum",
                      "duration": 3600
                  }
              }
          }
      ]
  },
  "method": [
      {
          "type": "action",
          "name": "copy-file",
          "provider": {
              "type": "process",
              "path": "./submit_input_files.sh",
              "arguments": "${s3_bucket} 300"
          },
          "pauses": {
              "after": 60
          }
      }
  ],
  "rollbacks": []
}
